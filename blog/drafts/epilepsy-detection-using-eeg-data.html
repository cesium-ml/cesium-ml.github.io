<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Cesium</title>
    <meta name="description" content="">
    <meta name="author" content="Cesium Developers">

    <link rel="stylesheet" href="http://cesium.ml/blog/theme/css/foundation.css" />
    <link rel="stylesheet" href="http://cesium.ml/blog/theme/css/pygment/friendly.css" />
    <link rel="stylesheet" href="http://cesium.ml/blog/theme/css/custom.css" />


    <script src="http://cesium.ml/blog/theme/js/modernizr.js"></script>

    <!-- Feeds -->
    <link href="http://cesium.ml/blog/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Cesium Atom Feed" />


    <!-- mathjax config similar to math.stackexchange -->
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      jax: ["input/TeX", "output/HTML-CSS"],
      tex2jax: {
        inlineMath: [ ['$', '$'] ],
        displayMath: [ ['$$', '$$']],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      },
      messageStyle: "none",
      "HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
    });
    </script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  </head>
  <body>
    <div class="off-canvas-wrap">
      <div class="inner-wrap">
        <!-- mobile top bar to activate nav -->
        <nav class="tab-bar show-for-small">
          <section class="left-small">
            <a class="left-off-canvas-toggle menu-icon" ><span></span></a>
          </section>

          <section class="middle tab-bar-section">
            <h1 class="title">Cesium</h1>
          </section>
        </nav>

        <!-- mobile side bar nav -->
        <aside class="left-off-canvas-menu">
          <ul class="off-canvas-list">
            <li><a href="http://cesium.ml/blog">Home</a></li>
            <li><label>Categories</label></li>
              <li ><a href="http://cesium.ml/blog/category/cesium.html">cesium</a></li>

            <li><label>Links</label></li>



            <li><label>Social</label></li>
              <li><a href="https://github.com/cesium-ml/cesium">GitHub</a></li>
              <li><a href="https://pypi.python.org/pypi/cesium">PyPi</a></li>
          </ul>
        </aside>

        <!-- top bar nav -->
        <nav class="top-bar hide-for-small-only" data-topbar>
          <ul class="title-area">
            <img src="http://cesium.ml/blog/theme/img/cesium-blue-dark.png" style="height: 45px; padding: 7.5px;"/>
            <li class="name">
              <h1><a href="http://cesium.ml/blog/">Cesium</a></h1>
            </li>
          </ul>

          <section class="top-bar-section">
            <ul class="left">
              <li><a href="https://github.com/cesium-ml/cesium">Code</a></li>
              <li><a href="http://cesium.ml/blog">Blog</li>
            </ul>
            <ul class="right">
              <li class="divider"></li>
              <li class="has-dropdown">
                <a href="#" class="">Learn</a>
                <ul class="dropdown">
                  <li><a href="#">About Cesium</a></li>
                  <li><a href="#">Tutorials</a></li>
                </ul>
              </li>
              <li class="divider"></li>
              <li class="has-form">
                <a href="#"
                   class="button">Try it in your browser</a>
              </li>
            </ul>
          </section>
        </nav>

        <!-- Main Page Content and Sidebar -->
        <section class="main-section">
          <div class="row">
            <!-- Main Content -->
            <div class="medium-9 small-12 columns" role="content">
<article>
	<h1>Epilepsy Detection Using EEG Data</h1>
	<blockquote>
<p>IPython notebook: <a href="http://cesium.ml/blog/drafts/notebooks/EEG_Example.ipynb" download="EEG_Example.ipynb">download</a></p>
</blockquote>
<p>In this example we&rsquo;ll use the <a href="http://github.com/cesium-ml/cesium/"><code>cesium</code></a> library to compare
various techniques for epilepsy detection using a classic EEG time series dataset from
<a href="http://www.meb.uni-bonn.de/epileptologie/science/physik/eegdata.html">Andrzejak et al.</a>.
The raw data are separated into five classes: Z, O, N, F, and S; we will consider a
three-class classification problem of distinguishing normal (Z, O), interictal (N, F), and
ictal (S) signals.</p>
<p>The overall workflow consists of three steps: first, we &ldquo;featurize&rdquo; the time series by
selecting some set of mathematical functions to apply to each; next, we build some
classification models which use these features to distinguish between classes;
finally, we validate our models by generating predictions for some unseen
holdout set and comparing them to the true class labels.</p>
<p>First, we&rsquo;ll load the data and inspect a representative time series from each class:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span><span class="p">;</span> <span class="n">seaborn</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

<span class="kn">from</span> <span class="nn">cesium</span> <span class="kn">import</span> <span class="n">datasets</span>

<span class="n">eeg</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">fetch_andrzejak</span><span class="p">()</span>

<span class="c1"># Group together classes (Z, O), (N, F), (S) as normal, interictal, ictal</span>
<span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;U16&#39;</span><span class="p">)</span> <span class="c1">#  allocate memory for longer class names</span>
<span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;Z&quot;</span><span class="p">,</span> <span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;O&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="s2">&quot;Normal&quot;</span>
<span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;F&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="s2">&quot;Interictal&quot;</span>
<span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">][</span><span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;S&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Ictal&quot;</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">])),</span> <span class="n">sharey</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">subplot</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">]),</span> <span class="n">ax</span><span class="p">):</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">label</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">subplot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;times&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;measurements&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
    <span class="n">subplot</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;time (s)&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;signal&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
</pre></div>
</div>


<p><img alt="png" src="http://cesium.ml/blog/drafts/images/EEG_Example_output_1_0.png" /></p>
<h2 id="featurization">Featurization</h2>
<p>Once the data is loaded, we can generate features for each time series using the
<a href="https://cesium.readthedocs.org/en/latest/api/cesium.featurize.html"><code>cesium.featurize</code></a>
module. The <code>featurize</code> module includes many built-in choices of features which can be applied
for any type of time series data; here we&rsquo;ve chosen a few generic features that do not have
any special biological significance.</p>
<p>If Celery is running, the time series will automatically be split among the available workers
and featurized in parallel; setting <code>use_celery=False</code> will cause the time series to be
featurized serially.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cesium</span> <span class="kn">import</span> <span class="n">featurize</span>
<span class="n">features_to_use</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;amplitude&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;percent_beyond_1_std&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;maximum&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;max_slope&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;median&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;median_absolute_deviation&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;percent_close_to_median&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;minimum&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;skew&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;std&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;weighted_average&#39;</span><span class="p">]</span>
<span class="n">fset_cesium</span> <span class="o">=</span> <span class="n">featurize</span><span class="o">.</span><span class="n">featurize_time_series</span><span class="p">(</span><span class="n">times</span><span class="o">=</span><span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;times&quot;</span><span class="p">],</span>
                                              <span class="n">values</span><span class="o">=</span><span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;measurements&quot;</span><span class="p">],</span>
                                              <span class="n">errors</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                                              <span class="n">features_to_use</span><span class="o">=</span><span class="n">features_to_use</span><span class="p">,</span>
                                              <span class="n">targets</span><span class="o">=</span><span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">],</span> <span class="n">use_celery</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">fset_cesium</span><span class="p">)</span>
</pre></div>
</div>


<div class="highlight-output"><div class="highlight"><pre><span></span>&lt;xarray.Dataset&gt;
Dimensions:                    (channel: 1, name: 500)
Coordinates:
  * channel                    (channel) int64 0
  * name                       (name) int64 0 1 2 3 4 5 6 7 8 9 10 11 12 13 ...
    target                     (name) object &#39;Normal&#39; &#39;Normal&#39; &#39;Normal&#39; ...
Data variables:
    minimum                    (name, channel) float64 -146.0 -254.0 -146.0 ...
    amplitude                  (name, channel) float64 143.5 211.5 165.0 ...
    median_absolute_deviation  (name, channel) float64 28.0 32.0 31.0 31.0 ...
    percent_beyond_1_std       (name, channel) float64 0.1626 0.1455 0.1523 ...
    maximum                    (name, channel) float64 141.0 169.0 184.0 ...
    median                     (name, channel) float64 -4.0 -51.0 13.0 -4.0 ...
    percent_close_to_median    (name, channel) float64 0.505 0.6405 0.516 ...
    max_slope                  (name, channel) float64 1.111e+04 2.065e+04 ...
    skew                       (name, channel) float64 0.0328 -0.09271 ...
    weighted_average           (name, channel) float64 -4.132 -52.44 12.71 ...
    std                        (name, channel) float64 40.41 48.81 47.14 ...
</pre></div>
</div>


<p>The output of
<a href="https://cesium.readthedocs.org/en/latest/api/cesium.featurize.html#cesium.featurize.featurize_time_series"><code>featurize_time_series</code></a>
is an <code>xarray.Dataset</code> which contains all the feature information needed to train a machine
learning model: feature values are stored as data variables, and the time series index/class
label are stored as coordinates (a <code>channel</code> coordinate will also be used later for
multi-channel data).</p>
<h3 id="custom-feature-functions">Custom feature functions</h3>
<p>Custom feature functions not built into <code>cesium</code> may be passed in using the
<code>custom_functions</code> keyword, either as a dictionary <code>{feature_name: function}</code>, or as a
<a href="http://dask.pydata.org/en/latest/custom-graphs.html">dask graph</a>. Functions should take
three arrays <code>times, measurements, errors</code> as inputs; details can be found in the
<code>cesium.featurize</code>
<a href="https://cesium.readthedocs.org/en/latest/api/cesium.featurize.html">documentation</a>.
Here we&rsquo;ll compute five standard features for EEG analysis provided by <a href="http://linkinghub.elsevier.com/retrieve/pii/S0957417411003253">Guo et al.
(2012)</a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span>

<span class="k">def</span> <span class="nf">mean_signal</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">std_signal</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">mean_square_signal</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">m</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">abs_diffs_signal</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">m</span><span class="p">)))</span>

<span class="k">def</span> <span class="nf">skew_signal</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">skew</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</pre></div>
</div>


<p>Now we&rsquo;ll pass the desired feature functions as a dictionary via the <code>custom_functions</code>
keyword argument.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">guo_features</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="n">mean_signal</span><span class="p">,</span>
    <span class="s1">&#39;std&#39;</span><span class="p">:</span> <span class="n">std_signal</span><span class="p">,</span>
    <span class="s1">&#39;mean2&#39;</span><span class="p">:</span> <span class="n">mean_square_signal</span><span class="p">,</span>
    <span class="s1">&#39;abs_diffs&#39;</span><span class="p">:</span> <span class="n">abs_diffs_signal</span><span class="p">,</span>
    <span class="s1">&#39;skew&#39;</span><span class="p">:</span> <span class="n">skew_signal</span>
<span class="p">}</span>

<span class="n">fset_guo</span> <span class="o">=</span> <span class="n">featurize</span><span class="o">.</span><span class="n">featurize_time_series</span><span class="p">(</span><span class="n">times</span><span class="o">=</span><span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;times&quot;</span><span class="p">],</span> <span class="n">values</span><span class="o">=</span><span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;measurements&quot;</span><span class="p">],</span>
                                           <span class="n">errors</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">],</span> 
                                           <span class="n">features_to_use</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">guo_features</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
                                           <span class="n">custom_functions</span><span class="o">=</span><span class="n">guo_features</span><span class="p">,</span>
                                           <span class="n">use_celery</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">fset_guo</span><span class="p">)</span>
</pre></div>
</div>


<div class="highlight-output"><div class="highlight"><pre><span></span>&lt;xarray.Dataset&gt;
Dimensions:    (channel: 1, name: 500)
Coordinates:
  * channel    (channel) int64 0
  * name       (name) int64 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 ...
    target     (name) object &#39;Normal&#39; &#39;Normal&#39; &#39;Normal&#39; &#39;Normal&#39; &#39;Normal&#39; ...
Data variables:
    abs_diffs  (name, channel) float64 4.695e+04 6.112e+04 5.127e+04 ...
    mean       (name, channel) float64 -4.132 -52.44 12.71 -3.992 -18.0 ...
    mean2      (name, channel) float64 1.65e+03 5.133e+03 2.384e+03 ...
    skew       (name, channel) float64 0.0328 -0.09271 -0.0041 0.06368 ...
    std        (name, channel) float64 40.41 48.81 47.14 47.07 44.91 45.02 ...
</pre></div>
</div>


<h3 id="multi-channel-time-series">Multi-channel time series</h3>
<p>The EEG time series considered here consist of univariate signal measurements along a
uniform time grid. But
<a href="https://cesium.readthedocs.org/en/latest/api/cesium.featurize.html#cesium.featurize.featurize_time_series"><code>featurize_time_series</code></a>
also accepts multi-channel data; to demonstrate this, we will decompose each signal into
five frequency bands using a discrete wavelet transform as suggested by <a href="http://www.sciencedirect.com/science/article/pii/S0957417404001745">Subasi
(2005)</a>, and then
featurize each band separately using the five functions from above.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pywt</span>

<span class="n">n_channels</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;dwts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pywt</span><span class="o">.</span><span class="n">wavedec</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">pywt</span><span class="o">.</span><span class="n">Wavelet</span><span class="p">(</span><span class="s1">&#39;db1&#39;</span><span class="p">),</span> <span class="n">level</span><span class="o">=</span><span class="n">n_channels</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
               <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;measurements&quot;</span><span class="p">]]</span>
<span class="n">fset_dwt</span> <span class="o">=</span> <span class="n">featurize</span><span class="o">.</span><span class="n">featurize_time_series</span><span class="p">(</span><span class="n">times</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;dwts&quot;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                                           <span class="n">features_to_use</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">guo_features</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
                                           <span class="n">targets</span><span class="o">=</span><span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">],</span>
                                           <span class="n">custom_functions</span><span class="o">=</span><span class="n">guo_features</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">fset_dwt</span><span class="p">)</span>
</pre></div>
</div>


<div class="highlight-output"><div class="highlight"><pre><span></span>&lt;xarray.Dataset&gt;
Dimensions:    (channel: 5, name: 500)
Coordinates:
  * channel    (channel) int64 0 1 2 3 4
  * name       (name) int64 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 ...
    target     (name) object &#39;Normal&#39; &#39;Normal&#39; &#39;Normal&#39; &#39;Normal&#39; &#39;Normal&#39; ...
Data variables:
    abs_diffs  (name, channel) float64 2.513e+04 1.806e+04 3.241e+04 ...
    skew       (name, channel) float64 -0.0433 0.06578 0.2999 0.1239 0.1179 ...
    mean2      (name, channel) float64 1.294e+04 5.362e+03 2.321e+03 664.4 ...
    mean       (name, channel) float64 -17.08 -6.067 -0.9793 0.1546 0.03555 ...
    std        (name, channel) float64 112.5 72.97 48.17 25.77 10.15 119.8 ...
</pre></div>
</div>


<p>The output featureset has the same form as before, except now the <code>channel</code> coordinate is
used to index the features by the corresponding frequency band. The functions in
<a href="https://cesium.readthedocs.org/en/latest/api/cesium.build_model.html"><code>cesium.build_model</code></a>
and <a href="https://cesium.readthedocs.org/en/latest/api/cesium.predict.html"><code>cesium.predict</code></a>
all accept featuresets from single- or multi-channel data, so no additional steps are
required to train models or make predictions for multichannel featuresets using the
<code>cesium</code> library.</p>
<h2 id="model-building">Model Building</h2>
<p>Model building in <code>cesium</code> is handled by the
<a href="https://cesium.readthedocs.org/en/latest/api/cesium.build_model.html#cesium.build_model.build_model_from_featureset"><code>build_model_from_featureset</code></a>
function in the <code>cesium.build_model</code> submodule. The featureset output by
<a href="https://cesium.readthedocs.org/en/latest/api/cesium.featurize.html#cesium.featurize.featurize_time_series"><code>featurize_time_series</code></a>
contains both the feature and target information needed to train a
model; <code>build_model_from_featureset</code> is simply a wrapper that calls the <code>fit</code> method of a
given <code>scikit-learn</code> model with the appropriate inputs. In the case of multichannel
features, it also handles reshaping the featureset into a (rectangular) form that is
compatible with <code>scikit-learn</code>.</p>
<p>For this example, we&rsquo;ll test a random forest classifier for the built-in <code>cesium</code> features,
and a 3-nearest neighbors classifier for the others, as suggested by <a href="http://linkinghub.elsevier.com/retrieve/pii/S0957417411003253">Guo et al.
(2012)</a>.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cesium.build_model</span> <span class="kn">import</span> <span class="n">build_model_from_featureset</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.cross_validation</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">])),</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">rfc_param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">1024</span><span class="p">]}</span>
<span class="n">model_cesium</span> <span class="o">=</span> <span class="n">build_model_from_featureset</span><span class="p">(</span><span class="n">fset_cesium</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">train</span><span class="p">),</span>
                                          <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">max_features</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span>
                                                                 <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                                          <span class="n">params_to_optimize</span><span class="o">=</span><span class="n">rfc_param_grid</span><span class="p">)</span>
<span class="n">knn_param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;n_neighbors&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]}</span>
<span class="n">model_guo</span> <span class="o">=</span> <span class="n">build_model_from_featureset</span><span class="p">(</span><span class="n">fset_guo</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">train</span><span class="p">),</span>
                                        <span class="n">KNeighborsClassifier</span><span class="p">(),</span>
                                        <span class="n">params_to_optimize</span><span class="o">=</span><span class="n">knn_param_grid</span><span class="p">)</span>
<span class="n">model_dwt</span> <span class="o">=</span> <span class="n">build_model_from_featureset</span><span class="p">(</span><span class="n">fset_dwt</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">train</span><span class="p">),</span>
                                        <span class="n">KNeighborsClassifier</span><span class="p">(),</span>
                                        <span class="n">params_to_optimize</span><span class="o">=</span><span class="n">knn_param_grid</span><span class="p">)</span>
</pre></div>
</div>


<h2 id="prediction">Prediction</h2>
<p>Making predictions for new time series based on these models follows the same pattern:
first the time series are featurized using
<a href="https://cesium.readthedocs.org/en/latest/api/cesium.featurize.html#cesium.featurize.featurize_time_series"><code>featurize_timeseries</code></a>,
and then predictions are made based on these features using
<a href="https://cesium.readthedocs.org/en/latest/api/cesium.predict.html#cesium.predict.model_predictions"><code>predict.model_predictions</code></a>,</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span>
<span class="kn">from</span> <span class="nn">cesium.predict</span> <span class="kn">import</span> <span class="n">model_predictions</span>

<span class="n">preds_cesium</span> <span class="o">=</span> <span class="n">model_predictions</span><span class="p">(</span><span class="n">fset_cesium</span><span class="p">,</span> <span class="n">model_cesium</span><span class="p">,</span> <span class="n">return_probs</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">preds_guo</span> <span class="o">=</span> <span class="n">model_predictions</span><span class="p">(</span><span class="n">fset_guo</span><span class="p">,</span> <span class="n">model_guo</span><span class="p">,</span> <span class="n">return_probs</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">preds_dwt</span> <span class="o">=</span> <span class="n">model_predictions</span><span class="p">(</span><span class="n">fset_dwt</span><span class="p">,</span> <span class="n">model_dwt</span><span class="p">,</span> <span class="n">return_probs</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Built-in cesium features: training accuracy={:.2%}, test accuracy={:.2%}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
          <span class="n">accuracy_score</span><span class="p">(</span><span class="n">preds_cesium</span><span class="p">[</span><span class="n">train</span><span class="p">],</span> <span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">][</span><span class="n">train</span><span class="p">]),</span>
          <span class="n">accuracy_score</span><span class="p">(</span><span class="n">preds_cesium</span><span class="p">[</span><span class="n">test</span><span class="p">],</span> <span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">][</span><span class="n">test</span><span class="p">])))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Guo et al. features: training accuracy={:.2%}, test accuracy={:.2%}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
          <span class="n">accuracy_score</span><span class="p">(</span><span class="n">preds_guo</span><span class="p">[</span><span class="n">train</span><span class="p">],</span> <span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">][</span><span class="n">train</span><span class="p">]),</span>
          <span class="n">accuracy_score</span><span class="p">(</span><span class="n">preds_guo</span><span class="p">[</span><span class="n">test</span><span class="p">],</span> <span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">][</span><span class="n">test</span><span class="p">])))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Wavelet transform features: training accuracy={:.2%}, test accuracy={:.2%}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
          <span class="n">accuracy_score</span><span class="p">(</span><span class="n">preds_dwt</span><span class="p">[</span><span class="n">train</span><span class="p">],</span> <span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">][</span><span class="n">train</span><span class="p">]),</span>
          <span class="n">accuracy_score</span><span class="p">(</span><span class="n">preds_dwt</span><span class="p">[</span><span class="n">test</span><span class="p">],</span> <span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">][</span><span class="n">test</span><span class="p">])))</span>
</pre></div>
</div>


<div class="highlight-output"><div class="highlight"><pre><span></span>Built-in cesium features: training accuracy=100.00%, test accuracy=83.20%
Guo et al. features: training accuracy=90.93%, test accuracy=84.80%
Wavelet transform features: training accuracy=100.00%, test accuracy=95.20%
</pre></div>
</div>


<p>The workflow presented here is intentionally simplistic and omits many important steps
such as feature selection, model parameter selection, etc. Since we make use of standard
<code>scikit-learn</code> models, additional steps can be incorporated in the same way they would be
for any other (non-time domain) machine learning problem.</p>
	<hr/>
	<h6>Written by <a href="http://cesium.ml/blog/author/cesium-developers.html">Cesium Developers</a> in <a href="http://cesium.ml/blog/category/misc.html">misc</a> on Mon 21 March 2016. Tags: <a href="http://cesium.ml/blog/tag/example.html">example</a>, </h6>
</article>

<hr/>
<div class="row">
	<div class="small-12 columns">
		<h3>Comments</h3>
		<div id="disqus_thread"></div>
		<script type="text/javascript">
			var disqus_shortname = 'cesium-ml';
			(function() {
				var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
				dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
				(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
			})();
		</script>
		<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
		<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
	</div>
</div>
            </div>
            <!-- End Main Content -->

            <!-- Sidebar -->
            <aside class="medium-3 hide-for-small-only columns">
              <div class="panel">
                <h5>Links</h5>
                <ul class="side-nav">
                </ul>
              </div>

              <div class="panel">
                <h5>Categories</h5>
                <ul class="tag-cloud">
                  <li ><a href="http://cesium.ml/blog/category/cesium.html">cesium</a></li>
                </ul>
              </div>


              <div class="panel">
                <h5>Social</h5>
                <ul class="side-nav">
                  <li><a href="https://github.com/cesium-ml/cesium">GitHub</a></li>
                  <li><a href="https://pypi.python.org/pypi/cesium">PyPi</a></li>
                </ul>
              </div>

            </aside>
            <!-- End Sidebar -->
          </div>

          <!-- Footer -->
          <footer class="row">
            <div class="medium-9 small-12">
              <hr/>
              <p class="text-center">Powered by <a href="http://getpelican.com">Pelican</a> and <a href="http://foundation.zurb.com/">Zurb Foundation</a>. Theme by <a href="http://hamaluik.com">Kenton Hamaluik</a>.</p>
            </div>
          </footer>
          <!-- End Footer -->
        </section>
        <a class="exit-off-canvas"></a>
      </div><!--off-canvas inner-->
    </div><!--off-canvas wrap-->

    <script src="http://cesium.ml/blog/theme/js/jquery.js"></script>
    <script src="http://cesium.ml/blog/theme/js/foundation.min.js"></script>
    <script>
      $(document).foundation();
    </script>
  </body>
</html>