<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Cesium</title>
    <meta name="description" content="">
    <meta name="author" content="Cesium Developers">

    <link rel="stylesheet" href="https://cesium-ml.org/blog/theme/css/foundation.css" />
    <link rel="stylesheet" href="https://cesium-ml.org/blog/theme/css/pygment/friendly.css" />
    <link rel="stylesheet" href="https://cesium-ml.org/blog/theme/css/custom.css" />


    <script src="https://cesium-ml.org/blog/theme/js/modernizr.js"></script>

    <!-- Feeds -->
    <link href="https://cesium-ml.org/blog/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Cesium Atom Feed" />

<script type="text/javascript">
    var disqus_shortname = 'cesium-ml';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>

    <!-- mathjax config similar to math.stackexchange -->
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      jax: ["input/TeX", "output/HTML-CSS"],
      tex2jax: {
        inlineMath: [ ['$', '$'] ],
        displayMath: [ ['$$', '$$']],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      },
      messageStyle: "none",
      "HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
    });
    </script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  </head>
  <body>
    <div class="off-canvas-wrap">
      <div class="inner-wrap">
        <!-- mobile top bar to activate nav -->
        <nav class="tab-bar show-for-small">
          <section class="left-small">
            <a class="left-off-canvas-toggle menu-icon" ><span></span></a>
          </section>

          <section class="middle tab-bar-section">
            <h1 class="title">Cesium</h1>
          </section>
        </nav>

        <!-- mobile side bar nav -->
        <aside class="left-off-canvas-menu">
          <ul class="off-canvas-list">
            <li><a href="https://cesium-ml.org/blog">Home</a></li>
            <li><label>Categories</label></li>
              <li ><a href="https://cesium-ml.org/blog/category/cesium.html">cesium</a></li>
              <li ><a href="https://cesium-ml.org/blog/category/engineering.html">engineering</a></li>
              <li class="active"><a href="https://cesium-ml.org/blog/category/misc.html">misc</a></li>

            <li><label>Links</label></li>



            <li><label>Social</label></li>
              <li><a href="https://github.com/cesium-ml/cesium">GitHub</a></li>
              <li><a href="https://pypi.python.org/pypi/cesium">PyPi</a></li>
          </ul>
        </aside>

        <!-- top bar nav -->
        <nav class="top-bar hide-for-small-only" data-topbar>
          <ul class="title-area">
              <a href="https://cesium-ml.org/blog/.."><img src="https://cesium-ml.org/blog/theme/img/cesium-blue-dark.png" style="height: 45px;
                  padding: 7.5px;"/></a>
            <li class="name">
              <h1><a href="https://cesium-ml.org/blog/">Cesium</a></h1>
            </li>
          </ul>

          <section class="top-bar-section">
            <ul class="left">
              <li><a href="https://github.com/cesium-ml/cesium">Code</a></li>
              <li><a href="https://cesium-ml.org/blog/../docs">Documentation</a></li>
              <li><a href="https://cesium-ml.org/blog">Blog</li>
            </ul>
            <ul class="right">
<!--              <li class="has-dropdown">
                <a href="#" class="">Learn</a>
                <ul class="dropdown">
                  <li><a href="#">About Cesium</a></li>
                  <li><a href="#">Tutorials</a></li>
                </ul>
</li>
              <li class="divider"></li>
              <li class="has-form">
                <a href="#"
                   class="button">Try it in your browser</a>
</li>-->
            </ul>
          </section>
        </nav>

        <!-- Main Page Content and Sidebar -->
        <section class="main-section">
          <div class="row">
            <!-- Main Content -->
            <div class="medium-9 small-12 columns" role="content">
<article>
	<h1>Epilepsy Detection Using EEG Data</h1>
	<blockquote>
<p>IPython notebook: <a href="https://cesium-ml.org/blog/2016/07/08/epilepsy-detection-using-eeg-data/notebooks/EEG_Example.ipynb" download="EEG_Example.ipynb">download</a></p>
</blockquote>
<p>In this example we'll use the <a href="http://github.com/cesium-ml/cesium/"><code>cesium</code></a> library to compare
various techniques for epilepsy detection using a classic EEG time series dataset from
<a href="http://www.meb.uni-bonn.de/epileptologie/science/physik/eegdata.html">Andrzejak et al.</a>.
The raw data are separated into five classes: Z, O, N, F, and S; we will consider a
three-class classification problem of distinguishing normal (Z, O), interictal (N, F), and
ictal (S) signals.</p>
<p>The overall workflow consists of three steps: first, we "featurize" the time series by
selecting some set of mathematical functions to apply to each; next, we build some
classification models which use these features to distinguish between classes;
finally, we validate our models by generating predictions for some unseen
holdout set and comparing them to the true class labels.</p>
<p>First, we'll load the data and inspect a representative time series from each class:</p>
<div class="highlight"><pre><span></span><code><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span><span class="p">;</span> <span class="n">seaborn</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

<span class="kn">from</span> <span class="nn">cesium</span> <span class="kn">import</span> <span class="n">datasets</span>

<span class="n">eeg</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">fetch_andrzejak</span><span class="p">()</span>

<span class="c1"># Group together classes (Z, O), (N, F), (S) as normal, interictal, ictal</span>
<span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;U16&#39;</span><span class="p">)</span> <span class="c1">#  allocate memory for longer class names</span>
<span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;Z&quot;</span><span class="p">,</span> <span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;O&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="s2">&quot;Normal&quot;</span>
<span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;F&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="s2">&quot;Interictal&quot;</span>
<span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">][</span><span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;S&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Ictal&quot;</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">])),</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">subplot</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">]),</span> <span class="n">ax</span><span class="p">):</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">label</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">subplot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;times&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;measurements&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
    <span class="n">subplot</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;time (s)&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;signal&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
</code></pre></div>

<p><img alt="png" src="https://cesium-ml.org/blog/2016/07/08/epilepsy-detection-using-eeg-data/images/EEG_Example_output_1_0.png"></p>
<h2>Featurization</h2>
<p>Once the data is loaded, we can generate features for each time series using the
<a href="https://cesium.readthedocs.org/en/latest/api/cesium.featurize.html"><code>cesium.featurize</code></a>
module. The <code>featurize</code> module includes many built-in choices of features which can be applied
for any type of time series data; here we've chosen a few generic features that do not have
any special biological significance.</p>
<p>If Celery is running, the time series will automatically be split among the available workers
and featurized in parallel; setting <code>use_celery=False</code> will cause the time series to be
featurized serially.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">cesium</span> <span class="kn">import</span> <span class="n">featurize</span>
<span class="n">features_to_use</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;amplitude&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;percent_beyond_1_std&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;maximum&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;max_slope&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;median&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;median_absolute_deviation&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;percent_close_to_median&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;minimum&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;skew&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;std&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;weighted_average&#39;</span><span class="p">]</span>
<span class="n">fset_cesium</span> <span class="o">=</span> <span class="n">featurize</span><span class="o">.</span><span class="n">featurize_time_series</span><span class="p">(</span><span class="n">times</span><span class="o">=</span><span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;times&quot;</span><span class="p">],</span>
                                              <span class="n">values</span><span class="o">=</span><span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;measurements&quot;</span><span class="p">],</span>
                                              <span class="n">errors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                              <span class="n">features_to_use</span><span class="o">=</span><span class="n">features_to_use</span><span class="p">,</span>
                                              <span class="n">targets</span><span class="o">=</span><span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">],</span> <span class="n">use_celery</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fset_cesium</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="o">&lt;</span><span class="n">xarray</span><span class="o">.</span><span class="n">Dataset</span><span class="o">&gt;</span>
<span class="n">Dimensions</span><span class="p">:</span>                    <span class="p">(</span><span class="n">channel</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="mi">500</span><span class="p">)</span>
<span class="n">Coordinates</span><span class="p">:</span>
  <span class="o">*</span> <span class="n">channel</span>                    <span class="p">(</span><span class="n">channel</span><span class="p">)</span> <span class="n">int64</span> <span class="mi">0</span>
  <span class="o">*</span> <span class="n">name</span>                       <span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="n">int64</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">10</span> <span class="mi">11</span> <span class="mi">12</span> <span class="mi">13</span> <span class="o">...</span>
    <span class="n">target</span>                     <span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="n">object</span> <span class="s1">&#39;Normal&#39;</span> <span class="s1">&#39;Normal&#39;</span> <span class="s1">&#39;Normal&#39;</span> <span class="o">...</span>
<span class="n">Data</span> <span class="n">variables</span><span class="p">:</span>
    <span class="n">minimum</span>                    <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">channel</span><span class="p">)</span> <span class="n">float64</span> <span class="o">-</span><span class="mf">146.0</span> <span class="o">-</span><span class="mf">254.0</span> <span class="o">-</span><span class="mf">146.0</span> <span class="o">...</span>
    <span class="n">amplitude</span>                  <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">channel</span><span class="p">)</span> <span class="n">float64</span> <span class="mf">143.5</span> <span class="mf">211.5</span> <span class="mf">165.0</span> <span class="o">...</span>
    <span class="n">median_absolute_deviation</span>  <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">channel</span><span class="p">)</span> <span class="n">float64</span> <span class="mf">28.0</span> <span class="mf">32.0</span> <span class="mf">31.0</span> <span class="mf">31.0</span> <span class="o">...</span>
    <span class="n">percent_beyond_1_std</span>       <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">channel</span><span class="p">)</span> <span class="n">float64</span> <span class="mf">0.1626</span> <span class="mf">0.1455</span> <span class="mf">0.1523</span> <span class="o">...</span>
    <span class="n">maximum</span>                    <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">channel</span><span class="p">)</span> <span class="n">float64</span> <span class="mf">141.0</span> <span class="mf">169.0</span> <span class="mf">184.0</span> <span class="o">...</span>
    <span class="n">median</span>                     <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">channel</span><span class="p">)</span> <span class="n">float64</span> <span class="o">-</span><span class="mf">4.0</span> <span class="o">-</span><span class="mf">51.0</span> <span class="mf">13.0</span> <span class="o">-</span><span class="mf">4.0</span> <span class="o">...</span>
    <span class="n">percent_close_to_median</span>    <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">channel</span><span class="p">)</span> <span class="n">float64</span> <span class="mf">0.505</span> <span class="mf">0.6405</span> <span class="mf">0.516</span> <span class="o">...</span>
    <span class="n">max_slope</span>                  <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">channel</span><span class="p">)</span> <span class="n">float64</span> <span class="mf">1.111e+04</span> <span class="mf">2.065e+04</span> <span class="o">...</span>
    <span class="n">skew</span>                       <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">channel</span><span class="p">)</span> <span class="n">float64</span> <span class="mf">0.0328</span> <span class="o">-</span><span class="mf">0.09271</span> <span class="o">...</span>
    <span class="n">weighted_average</span>           <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">channel</span><span class="p">)</span> <span class="n">float64</span> <span class="o">-</span><span class="mf">4.132</span> <span class="o">-</span><span class="mf">52.44</span> <span class="mf">12.71</span> <span class="o">...</span>
    <span class="n">std</span>                        <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">channel</span><span class="p">)</span> <span class="n">float64</span> <span class="mf">40.41</span> <span class="mf">48.81</span> <span class="mf">47.14</span> <span class="o">...</span>
</code></pre></div>

<p>The output of
<a href="https://cesium.readthedocs.org/en/latest/api/cesium.featurize.html#cesium.featurize.featurize_time_series"><code>featurize_time_series</code></a>
is an <code>xarray.Dataset</code> which contains all the feature information needed to train a machine
learning model: feature values are stored as data variables, and the time series index/class
label are stored as coordinates (a <code>channel</code> coordinate will also be used later for
multi-channel data).</p>
<h3>Custom feature functions</h3>
<p>Custom feature functions not built into <code>cesium</code> may be passed in using the
<code>custom_functions</code> keyword, either as a dictionary <code>{feature_name: function}</code>, or as a
<a href="http://dask.pydata.org/en/latest/custom-graphs.html">dask graph</a>. Functions should take
three arrays <code>times, measurements, errors</code> as inputs; details can be found in the
<code>cesium.featurize</code>
<a href="https://cesium.readthedocs.org/en/latest/api/cesium.featurize.html">documentation</a>.
Here we'll compute five standard features for EEG analysis provided by <a href="http://linkinghub.elsevier.com/retrieve/pii/S0957417411003253">Guo et al.
(2012)</a>:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span>

<span class="k">def</span> <span class="nf">mean_signal</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">std_signal</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">mean_square_signal</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">m</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">abs_diffs_signal</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">m</span><span class="p">)))</span>

<span class="k">def</span> <span class="nf">skew_signal</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">skew</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</code></pre></div>

<p>Now we'll pass the desired feature functions as a dictionary via the <code>custom_functions</code>
keyword argument.</p>
<div class="highlight"><pre><span></span><code><span class="n">guo_features</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="n">mean_signal</span><span class="p">,</span>
    <span class="s1">&#39;std&#39;</span><span class="p">:</span> <span class="n">std_signal</span><span class="p">,</span>
    <span class="s1">&#39;mean2&#39;</span><span class="p">:</span> <span class="n">mean_square_signal</span><span class="p">,</span>
    <span class="s1">&#39;abs_diffs&#39;</span><span class="p">:</span> <span class="n">abs_diffs_signal</span><span class="p">,</span>
    <span class="s1">&#39;skew&#39;</span><span class="p">:</span> <span class="n">skew_signal</span>
<span class="p">}</span>

<span class="n">fset_guo</span> <span class="o">=</span> <span class="n">featurize</span><span class="o">.</span><span class="n">featurize_time_series</span><span class="p">(</span><span class="n">times</span><span class="o">=</span><span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;times&quot;</span><span class="p">],</span> <span class="n">values</span><span class="o">=</span><span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;measurements&quot;</span><span class="p">],</span>
                                           <span class="n">errors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">],</span> 
                                           <span class="n">features_to_use</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">guo_features</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
                                           <span class="n">custom_functions</span><span class="o">=</span><span class="n">guo_features</span><span class="p">,</span>
                                           <span class="n">use_celery</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fset_guo</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="o">&lt;</span><span class="n">xarray</span><span class="o">.</span><span class="n">Dataset</span><span class="o">&gt;</span>
<span class="n">Dimensions</span><span class="p">:</span>    <span class="p">(</span><span class="n">channel</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="mi">500</span><span class="p">)</span>
<span class="n">Coordinates</span><span class="p">:</span>
  <span class="o">*</span> <span class="n">channel</span>    <span class="p">(</span><span class="n">channel</span><span class="p">)</span> <span class="n">int64</span> <span class="mi">0</span>
  <span class="o">*</span> <span class="n">name</span>       <span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="n">int64</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">10</span> <span class="mi">11</span> <span class="mi">12</span> <span class="mi">13</span> <span class="mi">14</span> <span class="mi">15</span> <span class="mi">16</span> <span class="mi">17</span> <span class="mi">18</span> <span class="o">...</span>
    <span class="n">target</span>     <span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="n">object</span> <span class="s1">&#39;Normal&#39;</span> <span class="s1">&#39;Normal&#39;</span> <span class="s1">&#39;Normal&#39;</span> <span class="s1">&#39;Normal&#39;</span> <span class="s1">&#39;Normal&#39;</span> <span class="o">...</span>
<span class="n">Data</span> <span class="n">variables</span><span class="p">:</span>
    <span class="n">abs_diffs</span>  <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">channel</span><span class="p">)</span> <span class="n">float64</span> <span class="mf">4.695e+04</span> <span class="mf">6.112e+04</span> <span class="mf">5.127e+04</span> <span class="o">...</span>
    <span class="n">mean</span>       <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">channel</span><span class="p">)</span> <span class="n">float64</span> <span class="o">-</span><span class="mf">4.132</span> <span class="o">-</span><span class="mf">52.44</span> <span class="mf">12.71</span> <span class="o">-</span><span class="mf">3.992</span> <span class="o">-</span><span class="mf">18.0</span> <span class="o">...</span>
    <span class="n">mean2</span>      <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">channel</span><span class="p">)</span> <span class="n">float64</span> <span class="mf">1.65e+03</span> <span class="mf">5.133e+03</span> <span class="mf">2.384e+03</span> <span class="o">...</span>
    <span class="n">skew</span>       <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">channel</span><span class="p">)</span> <span class="n">float64</span> <span class="mf">0.0328</span> <span class="o">-</span><span class="mf">0.09271</span> <span class="o">-</span><span class="mf">0.0041</span> <span class="mf">0.06368</span> <span class="o">...</span>
    <span class="n">std</span>        <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">channel</span><span class="p">)</span> <span class="n">float64</span> <span class="mf">40.41</span> <span class="mf">48.81</span> <span class="mf">47.14</span> <span class="mf">47.07</span> <span class="mf">44.91</span> <span class="mf">45.02</span> <span class="o">...</span>
</code></pre></div>

<h3>Multi-channel time series</h3>
<p>The EEG time series considered here consist of univariate signal measurements along a
uniform time grid. But
<a href="https://cesium.readthedocs.org/en/latest/api/cesium.featurize.html#cesium.featurize.featurize_time_series"><code>featurize_time_series</code></a>
also accepts multi-channel data; to demonstrate this, we will decompose each signal into
five frequency bands using a discrete wavelet transform as suggested by <a href="http://www.sciencedirect.com/science/article/pii/S0957417404001745">Subasi
(2005)</a>, and then
featurize each band separately using the five functions from above.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pywt</span>

<span class="n">n_channels</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;dwts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pywt</span><span class="o">.</span><span class="n">wavedec</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">pywt</span><span class="o">.</span><span class="n">Wavelet</span><span class="p">(</span><span class="s1">&#39;db1&#39;</span><span class="p">),</span> <span class="n">level</span><span class="o">=</span><span class="n">n_channels</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
               <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;measurements&quot;</span><span class="p">]]</span>
<span class="n">fset_dwt</span> <span class="o">=</span> <span class="n">featurize</span><span class="o">.</span><span class="n">featurize_time_series</span><span class="p">(</span><span class="n">times</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;dwts&quot;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                           <span class="n">features_to_use</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">guo_features</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
                                           <span class="n">targets</span><span class="o">=</span><span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">],</span>
                                           <span class="n">custom_functions</span><span class="o">=</span><span class="n">guo_features</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fset_dwt</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="o">&lt;</span><span class="n">xarray</span><span class="o">.</span><span class="n">Dataset</span><span class="o">&gt;</span>
<span class="n">Dimensions</span><span class="p">:</span>    <span class="p">(</span><span class="n">channel</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="mi">500</span><span class="p">)</span>
<span class="n">Coordinates</span><span class="p">:</span>
  <span class="o">*</span> <span class="n">channel</span>    <span class="p">(</span><span class="n">channel</span><span class="p">)</span> <span class="n">int64</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span>
  <span class="o">*</span> <span class="n">name</span>       <span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="n">int64</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">10</span> <span class="mi">11</span> <span class="mi">12</span> <span class="mi">13</span> <span class="mi">14</span> <span class="mi">15</span> <span class="mi">16</span> <span class="mi">17</span> <span class="mi">18</span> <span class="o">...</span>
    <span class="n">target</span>     <span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="n">object</span> <span class="s1">&#39;Normal&#39;</span> <span class="s1">&#39;Normal&#39;</span> <span class="s1">&#39;Normal&#39;</span> <span class="s1">&#39;Normal&#39;</span> <span class="s1">&#39;Normal&#39;</span> <span class="o">...</span>
<span class="n">Data</span> <span class="n">variables</span><span class="p">:</span>
    <span class="n">abs_diffs</span>  <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">channel</span><span class="p">)</span> <span class="n">float64</span> <span class="mf">2.513e+04</span> <span class="mf">1.806e+04</span> <span class="mf">3.241e+04</span> <span class="o">...</span>
    <span class="n">skew</span>       <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">channel</span><span class="p">)</span> <span class="n">float64</span> <span class="o">-</span><span class="mf">0.0433</span> <span class="mf">0.06578</span> <span class="mf">0.2999</span> <span class="mf">0.1239</span> <span class="mf">0.1179</span> <span class="o">...</span>
    <span class="n">mean2</span>      <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">channel</span><span class="p">)</span> <span class="n">float64</span> <span class="mf">1.294e+04</span> <span class="mf">5.362e+03</span> <span class="mf">2.321e+03</span> <span class="mf">664.4</span> <span class="o">...</span>
    <span class="n">mean</span>       <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">channel</span><span class="p">)</span> <span class="n">float64</span> <span class="o">-</span><span class="mf">17.08</span> <span class="o">-</span><span class="mf">6.067</span> <span class="o">-</span><span class="mf">0.9793</span> <span class="mf">0.1546</span> <span class="mf">0.03555</span> <span class="o">...</span>
    <span class="n">std</span>        <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">channel</span><span class="p">)</span> <span class="n">float64</span> <span class="mf">112.5</span> <span class="mf">72.97</span> <span class="mf">48.17</span> <span class="mf">25.77</span> <span class="mf">10.15</span> <span class="mf">119.8</span> <span class="o">...</span>
</code></pre></div>

<p>The output featureset has the same form as before, except now the <code>channel</code> coordinate is
used to index the features by the corresponding frequency band. The functions in
<a href="https://cesium.readthedocs.org/en/latest/api/cesium.build_model.html"><code>cesium.build_model</code></a>
and <a href="https://cesium.readthedocs.org/en/latest/api/cesium.predict.html"><code>cesium.predict</code></a>
all accept featuresets from single- or multi-channel data, so no additional steps are
required to train models or make predictions for multichannel featuresets using the
<code>cesium</code> library.</p>
<h2>Model Building</h2>
<p>Model building in <code>cesium</code> is handled by the
<a href="https://cesium.readthedocs.org/en/latest/api/cesium.build_model.html#cesium.build_model.build_model_from_featureset"><code>build_model_from_featureset</code></a>
function in the <code>cesium.build_model</code> submodule. The featureset output by
<a href="https://cesium.readthedocs.org/en/latest/api/cesium.featurize.html#cesium.featurize.featurize_time_series"><code>featurize_time_series</code></a>
contains both the feature and target information needed to train a
model; <code>build_model_from_featureset</code> is simply a wrapper that calls the <code>fit</code> method of a
given <code>scikit-learn</code> model with the appropriate inputs. In the case of multichannel
features, it also handles reshaping the featureset into a (rectangular) form that is
compatible with <code>scikit-learn</code>.</p>
<p>For this example, we'll test a random forest classifier for the built-in <code>cesium</code> features,
and a 3-nearest neighbors classifier for the others, as suggested by <a href="http://linkinghub.elsevier.com/retrieve/pii/S0957417411003253">Guo et al.
(2012)</a>.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">cesium.build_model</span> <span class="kn">import</span> <span class="n">build_model_from_featureset</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.cross_validation</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">])),</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">rfc_param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">1024</span><span class="p">]}</span>
<span class="n">model_cesium</span> <span class="o">=</span> <span class="n">build_model_from_featureset</span><span class="p">(</span><span class="n">fset_cesium</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">train</span><span class="p">),</span>
                                          <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">max_features</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span>
                                                                 <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                                          <span class="n">params_to_optimize</span><span class="o">=</span><span class="n">rfc_param_grid</span><span class="p">)</span>
<span class="n">knn_param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;n_neighbors&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]}</span>
<span class="n">model_guo</span> <span class="o">=</span> <span class="n">build_model_from_featureset</span><span class="p">(</span><span class="n">fset_guo</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">train</span><span class="p">),</span>
                                        <span class="n">KNeighborsClassifier</span><span class="p">(),</span>
                                        <span class="n">params_to_optimize</span><span class="o">=</span><span class="n">knn_param_grid</span><span class="p">)</span>
<span class="n">model_dwt</span> <span class="o">=</span> <span class="n">build_model_from_featureset</span><span class="p">(</span><span class="n">fset_dwt</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">train</span><span class="p">),</span>
                                        <span class="n">KNeighborsClassifier</span><span class="p">(),</span>
                                        <span class="n">params_to_optimize</span><span class="o">=</span><span class="n">knn_param_grid</span><span class="p">)</span>
</code></pre></div>

<h2>Prediction</h2>
<p>Making predictions for new time series based on these models follows the same pattern:
first the time series are featurized using
<a href="https://cesium.readthedocs.org/en/latest/api/cesium.featurize.html#cesium.featurize.featurize_time_series"><code>featurize_timeseries</code></a>,
and then predictions are made based on these features using
<a href="https://cesium.readthedocs.org/en/latest/api/cesium.predict.html#cesium.predict.model_predictions"><code>predict.model_predictions</code></a>,</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span>
<span class="kn">from</span> <span class="nn">cesium.predict</span> <span class="kn">import</span> <span class="n">model_predictions</span>

<span class="n">preds_cesium</span> <span class="o">=</span> <span class="n">model_predictions</span><span class="p">(</span><span class="n">fset_cesium</span><span class="p">,</span> <span class="n">model_cesium</span><span class="p">,</span> <span class="n">return_probs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">preds_guo</span> <span class="o">=</span> <span class="n">model_predictions</span><span class="p">(</span><span class="n">fset_guo</span><span class="p">,</span> <span class="n">model_guo</span><span class="p">,</span> <span class="n">return_probs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">preds_dwt</span> <span class="o">=</span> <span class="n">model_predictions</span><span class="p">(</span><span class="n">fset_dwt</span><span class="p">,</span> <span class="n">model_dwt</span><span class="p">,</span> <span class="n">return_probs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Built-in cesium features: training accuracy=</span><span class="si">{:.2%}</span><span class="s2">, test accuracy=</span><span class="si">{:.2%}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
          <span class="n">accuracy_score</span><span class="p">(</span><span class="n">preds_cesium</span><span class="p">[</span><span class="n">train</span><span class="p">],</span> <span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">][</span><span class="n">train</span><span class="p">]),</span>
          <span class="n">accuracy_score</span><span class="p">(</span><span class="n">preds_cesium</span><span class="p">[</span><span class="n">test</span><span class="p">],</span> <span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">][</span><span class="n">test</span><span class="p">])))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Guo et al. features: training accuracy=</span><span class="si">{:.2%}</span><span class="s2">, test accuracy=</span><span class="si">{:.2%}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
          <span class="n">accuracy_score</span><span class="p">(</span><span class="n">preds_guo</span><span class="p">[</span><span class="n">train</span><span class="p">],</span> <span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">][</span><span class="n">train</span><span class="p">]),</span>
          <span class="n">accuracy_score</span><span class="p">(</span><span class="n">preds_guo</span><span class="p">[</span><span class="n">test</span><span class="p">],</span> <span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">][</span><span class="n">test</span><span class="p">])))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Wavelet transform features: training accuracy=</span><span class="si">{:.2%}</span><span class="s2">, test accuracy=</span><span class="si">{:.2%}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
          <span class="n">accuracy_score</span><span class="p">(</span><span class="n">preds_dwt</span><span class="p">[</span><span class="n">train</span><span class="p">],</span> <span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">][</span><span class="n">train</span><span class="p">]),</span>
          <span class="n">accuracy_score</span><span class="p">(</span><span class="n">preds_dwt</span><span class="p">[</span><span class="n">test</span><span class="p">],</span> <span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">][</span><span class="n">test</span><span class="p">])))</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>Built-in cesium features: training accuracy=100.00%, test accuracy=83.20%
Guo et al. features: training accuracy=90.93%, test accuracy=84.80%
Wavelet transform features: training accuracy=100.00%, test accuracy=95.20%
</code></pre></div>

<p>The workflow presented here is intentionally simplistic and omits many important steps
such as feature selection, model parameter selection, etc., which may all be
incorporated just as they would for any other <code>scikit-learn</code> analysis.
But with essentially three function calls (<code>featurize_time_series</code>,
<code>build_model_from_featureset</code>, and <code>model_predictions</code>), we are able to build a
model from a set of time series and make predictions on new, unlabeled data. In
upcoming posts we'll introduce the web frontend for <code>cesium</code> and describe how
the same analysis can be performed in a browser with no setup or coding required.</p>
	<hr/>
	<h6>Written by <a href="https://cesium-ml.org/blog/author/cesium-developers.html">Cesium Developers</a> in <a href="https://cesium-ml.org/blog/category/misc.html">misc</a> on Fri 08 July 2016. Tags: <a href="https://cesium-ml.org/blog/tag/example.html">example</a>, </h6>
</article>

<hr/>
<div class="row">
	<div class="small-12 columns">
		<h3>Comments</h3>
		<div id="disqus_thread"></div>
		<script type="text/javascript">
			var disqus_shortname = 'cesium-ml';
			(function() {
				var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
				dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
				(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
			})();
		</script>
		<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
		<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
	</div>
</div>
            </div>
            <!-- End Main Content -->

            <!-- Sidebar -->
            <aside class="medium-3 hide-for-small-only columns">
              <div class="panel">
                <h5>Links</h5>
                <ul class="side-nav">
                </ul>
              </div>

              <div class="panel">
                <h5>Categories</h5>
                <ul class="tag-cloud">
                  <li ><a href="https://cesium-ml.org/blog/category/cesium.html">cesium</a></li>
                  <li ><a href="https://cesium-ml.org/blog/category/engineering.html">engineering</a></li>
                  <li class="active"><a href="https://cesium-ml.org/blog/category/misc.html">misc</a></li>
                </ul>
              </div>


              <div class="panel">
                <h5>Social</h5>
                <ul class="side-nav">
                  <li><a href="https://github.com/cesium-ml/cesium">GitHub</a></li>
                  <li><a href="https://pypi.python.org/pypi/cesium">PyPi</a></li>
                </ul>
              </div>

            </aside>
            <!-- End Sidebar -->
          </div>

          <!-- Footer -->
          <footer class="row">
            <div class="medium-9 small-12">
              <hr/>
              <p class="text-center">Powered by <a href="http://getpelican.com">Pelican</a> and <a href="http://foundation.zurb.com/">Zurb Foundation</a>. Theme by <a href="http://hamaluik.com">Kenton Hamaluik</a>.</p>
            </div>
          </footer>
          <!-- End Footer -->
        </section>
        <a class="exit-off-canvas"></a>
      </div><!--off-canvas inner-->
    </div><!--off-canvas wrap-->

    <script src="https://cesium-ml.org/blog/theme/js/jquery.js"></script>
    <script src="https://cesium-ml.org/blog/theme/js/foundation.min.js"></script>
    <script>
      $(document).foundation();
    </script>
  </body>
</html>